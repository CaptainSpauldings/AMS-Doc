# Advanced Management System

![Read the Doc!](https://github.com/CaptainSpauldings/AMS-Doc/raw/main/Images/Belushi/Read_the_doc.jpg)

[AMS Wiki](https://github.com/CaptainSpauldings/AMS-Doc/wiki)  
[AMS Source code](https://github.com/CaptainSpauldings/AMS) (private)  
[AMS Discussion](https://github.com/orgs/CaptainSpauldings/teams/amsdevteam) (private)  
[AMS Open Issues](https://github.com/CaptainSpauldings/AMS/issues) (private)  
[AMS Closed Issues](https://github.com/CaptainSpauldings/AMS/issues?q=is%3Aissue+is%3Aclosed) (private)  

## DESCRIPTION

AMS is a Lua library package for FlyWithLua.  
It allows a precise control over the tasks called at each loop and provides additional integration with X-Plane SDK.

&nbsp;  
&nbsp;  

## MAIN FEATURES

### • LOCAL VS. GLOBAL

FlyWithLua's architecture limits the uses of local functions, because all the callbacks need to have the functions on the global scope.  
AMS, on the other hand, has been designed to allow the use of local functions for the callbacks, avoiding any conflict between the scripts.
&nbsp;  
&nbsp;  
### • PREEMPTIVE TASK CONTROL

AMS implements a task management that allows one to pause, resume and kill each running process.  
A task can even kill and pause itself, or move from a loop to another.
&nbsp;  
&nbsp;  
### • PROTECTED CALLS

AMS tasks are executed as protected calls, thus every error generated by the called process doesn't stop the interpreter.  
When a task generates a certain amount of consecutive errors, that can be set by the user, the process gets automatically killed. All the error messages are reported in the log file. 
&nbsp;  
&nbsp;  
### • TIMERS

AMS takes track of the CPU usage of every task, giving information on the average and peak speed as well as the real-time value.  
This is useful to monitor the performance of the running processes and make a better optimization.
&nbsp;  
&nbsp;  
### • DATAREF MANAGER

AMS implements a system to take track of the datarefs' access requested by the scripts, to avoid duplicate access for the ones used by multiple scripts. It also takes care of making the custom defined datarefs and commandrefs visible to DatarefTool.
&nbsp;  
&nbsp;  
### • QUARANTINE-FREE LOADER

FlyWithLua adopted the quarantine mechanism to detect and remove faulty scripts. This system, though, has some side effects, such as moving the faulty script outside the `Script` directory as well as having issues related to false-positives.
AMS provides an alternative scripts loader that detects faulty scripts, reporting the error encountered in the log file, without moving it.  
All the scripts are loaded in protected mode, so the eventual errors on the script don't stop the interpreter.
&nbsp;  
&nbsp;  
### • KICKSTARTER

AMS can install its **_Kickstarter_** to get automatically loaded upon FlyWithLua startup.  
This allows AMS to take control of all the scripts available, not only the ones that explicitly require it, tracking their performance and dataref usage.
&nbsp;  
&nbsp;  
### • DEDICATED LOG FILE

AMS can divert all the output messages to a dedicated log file called `AMS_debug.log` that can be found in X-Plane's main dir. This makes it easier to browse the log and check for error messages.  
AMS's logger will take care of automatically inserting the timestamp and the name of the script at the beginning of each entry in the file.

&nbsp;  
&nbsp;  

## BLOCK DIAGRAM

AMS lays on top of FlyWithLua to get access to X-Plane SDK; it also implements it's own SDK wrapper to add functions missing in FlyWithLua.

The following is the block diagram of AMS used just as packages, called by the scripts that need it, and used with **_Kickstarter_**, where AMS takes control of all the installed scripts.

![AMS block diagram](https://github.com/CaptainSpauldings/AMS-Doc/raw/main/Images/ams.core.kernel/ams%20blockchart.png)


